{# src/_includes/layouts/post.njk #}
{% extends "layouts/base.njk" %}

{% block content %}

<section class="post-header">
  <div class="inner-wrapper">

    {# --- Category pill (safe, no macro) --- #}
    {% set catSlug = primaryCategory or (tags and tags[0]) %}
    {% if catSlug %}
      {% set catMap = {
        'math-education': 'Math Education',
        'data-science-modeling': 'Data Science & Modeling',
        'technology-ai': 'Technology & AI'
      } %}
      {% set catLabel = catMap[catSlug] or (catSlug | replace('-', ' ') | title) %}
      <span class="post-hero__pill">{{ catLabel }}</span>
    {% endif %}

    <h1 class="post-title u-underline">{{ title }}</h1>
    <p class="post-meta">
      <time datetime="{{ date | w3DateFilter }}">{{ date | dateFilter }}</time>
    </p>
  </div>
</section>

<main id="main-content" tabindex="-1">
  <article class="[ post ] [ h-entry ]">
    <div class="[ post__body ] [ inner-wrapper ] [ leading-loose pad-top-900 pad-bottom-900 text-500 ] [ sf-flow ] [ e-content ]">
      {{ content | safe }}
    </div>

<footer class="post-footer">

    {% if primaryCategory %}
  <p class="post-footer__meta">
    Posted under <a href="/tags/{{ primaryCategory }}/">{{ primaryCategory | replace('-', ' ') | title }}</a>
  </p>
{% endif %}
  {% if tags and tags.length %}
    <div class="post-tags">
      <span class="post-tags__label">Tags:</span>
      <ul class="post-tags__list" role="list">
        {% for t in tags %}
          {% if not primaryCategory or t != primaryCategory %}
            {% set label = t | replace('-', ' ') | title %}
            <li>
              <a class="chip chip--tag" href="/tags/{{ t }}/" aria-label="View posts tagged {{ label }}">
                {{ label }}
              </a>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
  {% endif %}
</footer>

  </article>
</main>

{% endblock %}
