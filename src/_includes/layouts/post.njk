{# src/_includes/layouts/post.njk #}
{% extends "layouts/base.njk" %}

{% block content %}

<section class="post-header">
  <div class="inner-wrapper">

    {# --- Category pill (safe, no macro) --- #}
    {% set catSlug = primaryCategory or (tags and tags[0]) %}
    {% if catSlug %}
      {% set catMap = {
        'math-education': 'Math Education',
        'data-science-modeling': 'Data Science & Modeling',
        'technology-ai': 'Technology & AI'
      } %}
      {% set catLabel = catMap[catSlug] or (catSlug | replace('-', ' ') | title) %}
      <span class="post-hero__pill">{{ catLabel }}</span>
    {% endif %}

    <h1 class="post-title u-underline">{{ title }}</h1>
    <p class="post-meta">
      <time datetime="{{ date | w3DateFilter }}">{{ date | dateFilter }}</time>
    </p>
  </div>
</section>

<main id="main-content" tabindex="-1">
  <article class="[ post ] [ h-entry ]">
    <div class="[ post__body ] [ inner-wrapper ] [ leading-loose pad-top-900 pad-bottom-900 text-500 ] [ sf-flow ] [ e-content ]">
      {{ content | safe }}
    </div>
  </article>
</main>

<footer class="post-footer">
  {# sharing helpers #}
  {% set shareUrl = site.url + page.url %}
  {% set engageText = engage or "Whatâ€™s your take? Share your thoughts or start a discussion:" %}
  {% set engageFlat = engageText | replace('\n',' ') %}

  {# CTA band (light gray) #}
  <section class="post-footer__cta">
    <div class="inner-wrapper post-footer__grid">

      <div class="subscribe">
        <h2 class="u-underline">Get updates</h2>
        <p>Be first to know when new lessons and posts go live.</p>
        <div class="ml-embedded" data-form="XYeqGG"></div>
      </div>

      <div class="social-cta">
        <h2 class="u-underline">Continue the conversation</h2>
        <p class="lead"><strong>{{ engageText }}</strong></p>
        <p class="meta">Let me know on X or LinkedIn.</p>
        <p>
          <a class="button"
             href="https://twitter.com/intent/tweet?url={{ shareUrl | urlencode }}&text={{ engageFlat | urlencode }}"
             target="_blank" rel="noopener">Discuss on X</a>
        </p>

        <p>
          <a class="button"
             href="https://www.linkedin.com/sharing/share-offsite/?url={{ shareUrl | urlencode }}"
             target="_blank" rel="noopener">Share on LinkedIn</a>
        </p>
      </div>

    </div>
  </section>

  {# Meta: Posted under + Tags #}
  <div class="inner-wrapper post-footer__meta-wrap">
    {% if primaryCategory %}
      <p class="post-footer__meta">
        Posted under <a href="/tags/{{ primaryCategory }}/">{{ primaryCategory | replace('-', ' ') | title }}</a>
      </p>
    {% endif %}

    {% if tags and tags.length %}
      <div class="post-tags">
        <span class="post-tags__label">Tags:</span>
        <ul class="post-tags__list" role="list">
          {% for t in tags %}
            {% if not primaryCategory or t != primaryCategory %}
              {% set label = t | replace('-', ' ') | title %}
              <li>
                <a class="chip chip--tag" href="/tags/{{ t }}/" aria-label="View posts tagged {{ label }}">
                  {{ label }}
                </a>
              </li>
            {% endif %}
          {% endfor %}
        </ul>
      </div>
    {% endif %}
  </div>
</footer>

{% endblock %}